#!/usr/bin/env python3

#this is a temporary solution to alter the rfifind mask to include channels that should be masked. This should be done at the end of CHIPSPIPE
#
#!/usr/bin/env python3

import numpy as np
import subprocess
import sys
ignorelist = "1023,989,988,987,986,985,984,983,982,981,980,979,978,977,976,910,909,908,907,906,905,904,903,902,901,900,899,898,897,896,895,894,893,892,891,890,889,888,887,886,885,884,883,882,881,880,879,878,877,876,875,874,873,872,871,870,869,868,867,866,865,864,863,862,861,860,859,858,857,856,855,854,853,852,851,850,849,848,847,846,845,838,837,836,835,834,833,832,831,830,829,828,827,826,825,824,823,822,821,820,819,818,817,816,815,814,813,805,804,803,802,801,800,799,798,797,796,795,794,793,792,791,790,789,788,787,786,785,784,783,782,781,780,779,778,777,776,775,774,773,772,771,770,769,618,617,616,615,614,613,612,611,610,609,608,607,606,605,604,603,602,601,600,599,598,597,596,595,594,593,592,591,590,589,588,587,586,585,584,583,582,581,580,579,578,577,576,575,574,573,572,571,570,569,568,567,566,565,564,563,562,561,560,559,558,557,556,555,554,471,470,469,468,467,466,465,464,463,462,461,460,459,458,457,456,455,451,448,439,438,437,436,435,434,433,432,431,430,429,428,427,426,392,391,390,389,388,387,386,385,384,383,382,381,380,379,346,345,344,343,342,341,340,339,338,337,336,335,334,333,332,331,330,269,268,267,266,265,264,263,262,261,235,234,233,232,177,169,168,167,166,165,164,163,150,149,148,140,136"
maskfn = sys.argv[1]
#add additional zapchans to mask
basename = maskfn.replace("_rfifind.mask","")
command = f"rfifind -mask {maskfn} -zapchan {ignorelist} -nocompute -o {basename} {basename}.fil"
run_rfifind_cmd = subprocess.check_call([command], shell=True)
